<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Chevron</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f4f7f6; color: #333; margin: 0; padding: 20px; }
        h1, h2 { color: #2c3e50; }
        .container { max-width: 1200px; margin: auto; }
        .management-section, .access-denied { background-color: #ffffff; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { padding: 12px; border: 1px solid #ddd; text-align: left; }
        th { background-color: #e0e0e0; }
        form label { display: block; margin-top: 10px; font-weight: bold; }
        form input { width: 100%; padding: 8px; margin-top: 5px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; }
        form button { margin-top: 20px; padding: 10px 15px; background-color: #28a745; color: white; border: none; cursor: pointer; border-radius: 5px; }
        .delete-btn { padding: 5px 10px; background-color: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .header { display: flex; justify-content: space-between; align-items: center; }
        #logout-btn { padding: 8px 15px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <!-- This container will only be shown to authorized admins -->
    <div id="admin-content" class="container" style="display: none;">
        <div class="header">
            <h1>Chevron App - Admin Panel</h1>
            <button id="logout-btn">Logout</button>
        </div>
        
        <section class="management-section">
            <h2>Manage Investment Packages</h2>
            <!-- ... (rest of the sections remain the same) ... -->
            <table>
                <thead>
                    <tr>
                        <th>Package Name</th>
                        <th>Investment Amount</th>
                        <th>Daily Commission</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="package-table-body"></tbody>
            </table>
            <hr style="margin: 20px 0;">
            <h2>Create New Package</h2>
            <form id="create-package-form" onsubmit="createPackage(event)">
                <label for="packageName">Package Name:</label>
                <input type="text" id="packageName" required>
                <label for="investmentAmount">Investment Amount ($):</label>
                <input type="number" id="investmentAmount" required>
                <label for="commissionAmount">Daily Commission ($):</label>
                <input type="number" id="commissionAmount" required>
                <button type="submit">Create Package</button>
            </form>
        </section>

        <section class="management-section">
            <h2>User Management</h2>
            <table>
                <thead>
                    <tr>
                        <th>Mobile Number</th>
                        <th>Balance</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="user-table-body"></tbody>
            </table>
        </section>
    </div>

    <!-- This message is shown if the user is not an admin -->
    <div id="access-denied" class="access-denied" style="display: none; text-align: center;">
        <h2>Access Denied</h2>
        <p>You do not have permission to view this page.</p>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    
    <script>
        // --- PASTE YOUR FIREBASE CONFIGURATION HERE ---
        const firebaseConfig = {

  apiKey: "AIzaSyDVfH3eqx2vDrLfxAzNv8b0-_siZ6XxI5s",

  authDomain: "chevron-bot.firebaseapp.com",

  databaseURL: "https://chevron-bot-default-rtdb.firebaseio.com",

  projectId: "chevron-bot",

  storageBucket: "chevron-bot.firebasestorage.app",

  messagingSenderId: "131795679177",

  appId: "1:131795679177:web:3a5d9a3f640f5a30a61a18"

};
        // --- END OF FIREBASE CONFIG ---

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        const adminContent = document.getElementById('admin-content');
        const accessDenied = document.getElementById('access-denied');
        const logoutBtn = document.getElementById('logout-btn');

        auth.onAuthStateChanged(async (user) => {
            if (user) {
                // User is signed in. Now, check if they are an admin.
                const userDoc = await db.collection('users').doc(user.uid).get();
                if (userDoc.exists && userDoc.data().role === 'admin') {
                    // If user is an admin, show the content
                    adminContent.style.display = 'block';
                    loadAdminData();
                } else {
                    // If not an admin, show access denied message
                    accessDenied.style.display = 'block';
                    // Optional: sign them out automatically
                    auth.signOut();
                }
            } else {
                // No user is signed in, redirect to the admin login page
                window.location.replace('admin-login.html');
            }
        });

        logoutBtn.addEventListener('click', () => {
            auth.signOut();
        });
        
        // This function loads all data once access is granted
        function loadAdminData() {
            const packageTableBody = document.getElementById('package-table-body');
            const userTableBody = document.getElementById('user-table-body');

            // Load packages
            db.collection('packages').orderBy('createdAt', 'desc').onSnapshot(snapshot => {
                let html = snapshot.empty ? '<tr><td colspan="4">No packages found.</td></tr>' : '';
                snapshot.forEach(doc => {
                    const pkg = doc.data();
                    html += `<tr><td>${pkg.name}</td><td>$${pkg.investment}</td><td>$${pkg.commission}</td><td><button class="delete-btn" onclick="deletePackage('${doc.id}')">Delete</button></td></tr>`;
                });
                packageTableBody.innerHTML = html;
            });
            
            // Load users
            db.collection('users').orderBy('createdAt', 'desc').onSnapshot(snapshot => {
                let html = snapshot.empty ? '<tr><td colspan="3">No users found.</td></tr>' : '';
                snapshot.forEach(doc => {
                    const user = doc.data();
                    html += `<tr><td>${user.mobile || 'N/A'}</td><td>$${user.balance.toFixed(2)}</td><td>${user.isActive ? 'Active' : 'Suspended'}</td></tr>`;
                });
                userTableBody.innerHTML = html;
            });
        }
        
        const createPackageForm = document.getElementById('create-package-form');

        async function createPackage(event) {
            // ... (createPackage and deletePackage functions remain the same)
            event.preventDefault();
            const packageName = createPackageForm['packageName'].value;
            const investmentAmount = parseFloat(createPackageForm['investmentAmount'].value);
            const commissionAmount = parseFloat(createPackageForm['commissionAmount'].value);
            try {
                await db.collection('packages').add({
                    name: packageName,
                    investment: investmentAmount,
                    commission: commissionAmount,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                alert('Package created successfully!');
                createPackageForm.reset();
            } catch (error) {
                alert('Error creating package.');
            }
        }
        
        async function deletePackage(id) {
            if (confirm('Are you sure you want to delete this package?')) {
                await db.collection('packages').doc(id).delete();
            }
        }
    </script>
</body>
</html>